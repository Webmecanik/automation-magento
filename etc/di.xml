<?xml version="1.0"?>
<config xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:noNamespaceSchemaLocation="urn:magento:framework:ObjectManager/etc/config.xsd">
    <type name="Webmecanik\Connector\Model\ResourceModel\Queue\Grid\Collection">
        <arguments>
            <argument name="mainTable" xsi:type="string">queue_message_status</argument>
            <argument name="resourceModel" xsi:type="string">Magento\MysqlMq\Model\ResourceModel\MessageStatus</argument>
        </arguments>
    </type>

    <type name="Magento\Framework\Console\CommandListInterface">
        <arguments>
            <argument name="commands" xsi:type="array">
                <item name="webmecanik-export-all-contacts"
                      xsi:type="object">Webmecanik\Connector\Console\Command\ExportAllContacts</item>
            </argument>
        </arguments>
    </type>

    <type name="Magento\Sales\Model\ResourceModel\Order">
        <plugin name="webmecanik-publish-order-on-transform" type="Webmecanik\Connector\Plugin\PublishOrderOnTransform"/>
    </type>
    <type name="Magento\MysqlMq\Model\Driver\Queue">
        <plugin name="webmecanik-save-rejection-message" type="Webmecanik\Connector\Plugin\SaveRejectionMessage"/>
        <plugin name="webmecanik-send-notification-email" type="Webmecanik\Connector\Plugin\SendEmailOnRejection"/>
    </type>
    <type name="Magento\MysqlMq\Model\ResourceModel\Queue">
        <plugin name="webmecanik-remove-message-rejection-on-retry"
                type="Webmecanik\Connector\Plugin\RemoveRejectionMessageOnRetry"/>
    </type>

    <type name="Magento\Framework\View\Element\UiComponent\DataProvider\CollectionFactory">
        <arguments>
            <argument name="collections" xsi:type="array">
                <item name="webmecanik_queue_list_data_source" xsi:type="string">
                    Webmecanik\Connector\Model\ResourceModel\Queue\Grid\Collection
                </item>
            </argument>
        </arguments>
    </type>

    <preference for="Mautic\Auth\AuthInterface" type="Mautic\Auth\TwoLeggedOAuth2"/>
    <preference for="Webmecanik\Connector\Api\SubscriptionUpdateInterface" type="Webmecanik\Connector\Model\SubscriptionWebhook"/>
    <type name="Magento\MysqlMq\Model\QueueManagement">
        <plugin name="webmecanik-webmecanik-kill-consumer-on-poison-pill" type="Webmecanik\Connector\Plugin\KillConsumerOnPoisonPill"/>
        <plugin name="webmecanik-webmecanik-prevent-message-reading" type="Webmecanik\Connector\Plugin\PreventMessageReading"/>
    </type>
</config>
